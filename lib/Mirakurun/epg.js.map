{"version":3,"sources":["Mirakurun/epg.ts"],"names":[],"mappings":"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","file":"Mirakurun/epg.js","sourcesContent":["/*\r\n   Copyright 2016 Yuki KAN\r\n\r\n   Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   you may not use this file except in compliance with the License.\r\n   You may obtain a copy of the License at\r\n\r\n       http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n   Unless required by applicable law or agreed to in writing, software\r\n   distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   See the License for the specific language governing permissions and\r\n   limitations under the License.\r\n*/\r\n/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\n\r\nimport * as stream from \"stream\";\r\nimport * as log from \"./log\";\r\nimport db from \"./db\";\r\nimport queue from \"./queue\";\r\nimport ProgramItem from \"./ProgramItem\";\r\nconst aribts = require(\"aribts\");\r\nconst TsChar = aribts.TsChar;\r\nconst TsDate = aribts.TsDate;\r\n\r\nconst STREAM_CONTENT = {\r\n    1: \"mpeg2\",\r\n    5: \"h.264\",\r\n    9: \"h.265\"\r\n};\r\n\r\nconst COMPONENT_TYPE = {\r\n    0x01: \"480i\",\r\n    0x02: \"480i\",\r\n    0x03: \"480i\",\r\n    0x04: \"480i\",\r\n    0x83: \"4320p\",\r\n    0x91: \"2160p\",\r\n    0x92: \"2160p\",\r\n    0x93: \"2160p\",\r\n    0x94: \"2160p\",\r\n    0xA1: \"480p\",\r\n    0xA2: \"480p\",\r\n    0xA3: \"480p\",\r\n    0xA4: \"480p\",\r\n    0xB1: \"1080i\",\r\n    0xB2: \"1080i\",\r\n    0xB3: \"1080i\",\r\n    0xB4: \"1080i\",\r\n    0xC1: \"720p\",\r\n    0xC2: \"720p\",\r\n    0xC3: \"720p\",\r\n    0xC4: \"720p\",\r\n    0xD1: \"240p\",\r\n    0xD2: \"240p\",\r\n    0xD3: \"240p\",\r\n    0xD4: \"240p\",\r\n    0xE1: \"1080p\",\r\n    0xE2: \"1080p\",\r\n    0xE3: \"1080p\",\r\n    0xE4: \"1080p\",\r\n    0xF1: \"180p\",\r\n    0xF2: \"180p\",\r\n    0xF3: \"180p\",\r\n    0xF4: \"180p\"\r\n};\r\n\r\nconst SAMPLING_RATE = {\r\n    0: -1,\r\n    1: 16000,\r\n    2: 22050,\r\n    3: 24000,\r\n    4: -1,\r\n    5: 32000,\r\n    6: 44100,\r\n    7: 48000\r\n};\r\n\r\ninterface EventState {\r\n    version: VersionState;\r\n    program: ProgramItem;\r\n\r\n    short: {\r\n        version: number; // basic\r\n        event_name_char: Buffer;\r\n        text_char: Buffer;\r\n    };\r\n    extended: {\r\n        version: number; // extended\r\n        _descs: {\r\n            item_description_length: number;\r\n            item_description_char: Buffer;\r\n            item_length: number;\r\n            item_char: Buffer;\r\n        }[][];\r\n        _done: boolean;\r\n    };\r\n    component: {\r\n        version: number; // basic\r\n        stream_content: number;\r\n        component_type: number;\r\n    };\r\n    content: {\r\n        version: number; // basic\r\n        _raw: Buffer;\r\n    };\r\n    audio: {\r\n        version: number; // basic\r\n        _raw: Buffer;\r\n    };\r\n    group: {\r\n        version: number; // basic\r\n        _raw: Buffer;\r\n    };\r\n}\r\n\r\ninterface VersionState {\r\n    basic: number;\r\n    extended: number;\r\n}\r\n\r\n// forked from rndomhack/node-aribts/blob/1e7ef94bba3d6ac26aec764bf24dde2c2852bfcb/lib/epg.js\r\nclass EPG extends stream.Writable {\r\n\r\n    private _epg: { [networkId: number]: { [serviceId: number]: { [eventId: number]: EventState } } } = {};\r\n    private _epgGCInterval = 1000 * 60 * 15;\r\n\r\n    constructor() {\r\n        super({\r\n            objectMode: true\r\n        });\r\n\r\n        setTimeout(this._gc.bind(this), this._epgGCInterval);\r\n    }\r\n\r\n    _write(eit: any, encoding, callback) {\r\n\r\n        const networkId = eit.original_network_id;\r\n\r\n        if (typeof this._epg[networkId] === \"undefined\") {\r\n            this._epg[networkId] = {};\r\n        }\r\n\r\n        if (typeof this._epg[networkId][eit.service_id] === \"undefined\") {\r\n            this._epg[networkId][eit.service_id] = {};\r\n        }\r\n\r\n        const service = this._epg[networkId][eit.service_id];\r\n\r\n        for (let i = 0, l = eit.events.length, e; i < l; i++) {\r\n            e = eit.events[i];\r\n            let state: EventState;\r\n\r\n            if (typeof service[e.event_id] === \"undefined\") {\r\n                state = {\r\n                    version: {\r\n                        basic: isBasicTable(eit.table_id) ? eit.version_number : -1,\r\n                        extended: isBasicTable(eit.table_id) ? -1 : eit.version_number\r\n                    },\r\n                    program: new ProgramItem({\r\n                        id: getProgramId(networkId, eit.service_id, e.event_id),\r\n\r\n                        eventId: e.event_id,\r\n                        serviceId: eit.service_id,\r\n                        networkId: networkId,\r\n                        startAt: getTime(e.start_time),\r\n                        duration: getTimeFromBCD24(e.duration),\r\n                        isFree: e.free_CA_mode === 0\r\n                    }),\r\n\r\n                    short: {\r\n                        version: -1,\r\n                        event_name_char: null,\r\n                        text_char: null\r\n                    },\r\n                    extended: {\r\n                        version: -1,\r\n                        _descs: null,\r\n                        _done: true\r\n                    },\r\n                    component: {\r\n                        version: -1,\r\n                        stream_content: -1,\r\n                        component_type: -1\r\n                    },\r\n                    content: {\r\n                        version: -1,\r\n                        _raw: null\r\n                    },\r\n                    audio: {\r\n                        version: -1,\r\n                        _raw: null\r\n                    },\r\n                    group: {\r\n                        version: -1,\r\n                        _raw: null\r\n                    }\r\n                };\r\n\r\n                service[e.event_id] = state;\r\n            } else {\r\n                state = service[e.event_id];\r\n\r\n                if (isOutOfDate(state, eit) === true) {\r\n                    if (isBasicTable(eit.table_id) === true) {\r\n                        state.version.basic = eit.version_number;\r\n                    } else {\r\n                        state.version.extended = eit.version_number;\r\n                    }\r\n\r\n                    state.program.update({\r\n                        startAt: getTime(e.start_time),\r\n                        duration: getTimeFromBCD24(e.duration),\r\n                        isFree: e.free_CA_mode === 0\r\n                    });\r\n                }\r\n            }\r\n\r\n            for (let j = 0, m = e.descriptors.length, d; j < m; j++) {\r\n                d = e.descriptors[j];\r\n\r\n                switch (d.descriptor_tag) {\r\n                    // short_event\r\n                    case 0x4D:\r\n                        if (state.short.version === eit.version_number) {\r\n                            break;\r\n                        }\r\n                        state.short.version = eit.version_number;\r\n\r\n                        if (\r\n                            state.short.event_name_char !== null &&\r\n                            state.short.text_char !== null &&\r\n                            state.short.event_name_char.compare(d.event_name_char) === 0 &&\r\n                            state.short.text_char.compare(d.text_char) === 0\r\n                        ) {\r\n                            break;\r\n                        }\r\n\r\n                        state.short.event_name_char = d.event_name_char;\r\n                        state.short.text_char = d.text_char;\r\n\r\n                        state.program.update({\r\n                            name: new TsChar(d.event_name_char).decode(),\r\n                            description: new TsChar(d.text_char).decode()\r\n                        });\r\n\r\n                        break;\r\n\r\n                    // extended_event\r\n                    case 0x4E:\r\n                        if (state.extended.version !== eit.version_number) {\r\n                            state.extended.version = eit.version_number;\r\n                            state.extended._descs = new Array(d.last_descriptor_number + 1);\r\n                            state.extended._done = false;\r\n                        } else if (state.extended._done === true) {\r\n                            break;\r\n                        }\r\n\r\n                        if (state.extended._descs[d.descriptor_number] === undefined) {\r\n                            state.extended._descs[d.descriptor_number] = d.items;\r\n\r\n                            let comp = true;\r\n                            for (let i = 0, l = state.extended._descs.length; i < l; i++) {\r\n                                if (state.extended._descs[i] === undefined) {\r\n                                    comp = false;\r\n                                    break;\r\n                                }\r\n                            }\r\n                            if (comp === false) {\r\n                                break;\r\n                            }\r\n\r\n                            const extended: any = {};\r\n\r\n                            let current = \"\";\r\n                            for (let i = 0, l = state.extended._descs.length; i < l; i++) {\r\n                                for (let j = 0, m = state.extended._descs[i].length; j < m; j++) {\r\n                                    const desc = state.extended._descs[i][j].item_description_length === 0\r\n                                                ? current\r\n                                                : new TsChar(state.extended._descs[i][j].item_description_char).decode();\r\n                                    current = desc;\r\n\r\n                                    const char = new TsChar(state.extended._descs[i][j].item_char).decode();\r\n                                    if (extended[desc] === undefined) {\r\n                                        extended[desc] = char;\r\n                                    } else {\r\n                                        extended[desc] += char;\r\n                                    }\r\n                                }\r\n                                state.extended._descs[i] = null; // clean up\r\n                            }\r\n\r\n                            state.program.update({\r\n                                extended: extended\r\n                            });\r\n\r\n                            state.extended._done = true; // done\r\n                        }\r\n\r\n                        break;\r\n\r\n                    // component\r\n                    case 0x50:\r\n                        if (state.component.version === eit.version_number) {\r\n                            break;\r\n                        }\r\n                        state.component.version = eit.version_number;\r\n\r\n                        if (\r\n                            state.component.stream_content === d.stream_content &&\r\n                            state.component.component_type === d.component_type\r\n                        ) {\r\n                            break;\r\n                        }\r\n\r\n                        state.component.stream_content = d.stream_content;\r\n                        state.component.component_type = d.component_type;\r\n\r\n                        state.program.update({\r\n                            video: {\r\n                                type: <db.ProgramVideoType>STREAM_CONTENT[d.stream_content] || null,\r\n                                resolution: <db.ProgramVideoResolution>COMPONENT_TYPE[d.component_type] || null,\r\n\r\n                                streamContent: d.stream_content,\r\n                                componentType: d.component_type\r\n                            }\r\n                        });\r\n\r\n                        break;\r\n\r\n                    // content\r\n                    case 0x54:\r\n                        if (state.content.version === eit.version_number) {\r\n                            break;\r\n                        }\r\n                        state.content.version = eit.version_number;\r\n\r\n                        if (\r\n                            state.content._raw !== null &&\r\n                            state.content._raw.compare(d._raw) === 0\r\n                        ) {\r\n                            break;\r\n                        }\r\n\r\n                        state.content._raw = d._raw;\r\n\r\n                        state.program.update({\r\n                            genres: d.contents.map(getGenre)\r\n                        });\r\n\r\n                        break;\r\n\r\n                    // audio component\r\n                    case 0xC4:\r\n                        if (state.audio.version === eit.version_number) {\r\n                            break;\r\n                        }\r\n                        state.audio.version = eit.version_number;\r\n\r\n                        if (\r\n                            state.audio._raw !== null &&\r\n                            state.audio._raw.compare(d._raw) === 0\r\n                        ) {\r\n                            break;\r\n                        }\r\n\r\n                        state.audio._raw = d._raw;\r\n\r\n                        state.program.update({\r\n                            audio: {\r\n                                samplingRate: SAMPLING_RATE[d.sampling_rate],\r\n                                componentType: d.component_type\r\n                            }\r\n                        });\r\n\r\n                        break;\r\n\r\n                    // event_group\r\n                    case 0xD6:\r\n                        if (state.group.version === eit.version_number) {\r\n                            break;\r\n                        }\r\n                        state.group.version = eit.version_number;\r\n\r\n                        if (\r\n                            state.group._raw !== null &&\r\n                            state.group._raw.compare(d._raw) === 0\r\n                        ) {\r\n                            break;\r\n                        }\r\n\r\n                        state.group._raw = d._raw;\r\n\r\n                        if (typeof d.other_network_events === \"undefined\") {\r\n                            state.program.update({\r\n                                relatedItems: d.events.map(getRelatedProgramItem)\r\n                            });\r\n                        } else {\r\n                            state.program.update({\r\n                                relatedItems: [\r\n                                    ...d.events.map(getRelatedProgramItem),\r\n                                    ...d.other_network_events.map(getRelatedProgramItem)\r\n                                ]\r\n                            });\r\n                        }\r\n\r\n                        break;\r\n                }// <- switch\r\n            }// <- for\r\n        }// <- for\r\n\r\n        callback();\r\n    }\r\n\r\n    private _gc(): void {\r\n\r\n        log.info(\"EPG GC has queued\");\r\n\r\n        queue.add(() => {\r\n\r\n            const now = Date.now();\r\n            let count = 0;\r\n\r\n            for (const nid in this._epg) {\r\n                for (const sid in this._epg[nid]) {\r\n                    for (const eid in this._epg[nid][sid]) {\r\n                        const state = this._epg[nid][sid][eid];\r\n                        if (now > (state.program.data.startAt + state.program.data.duration)) {\r\n                            ++count;\r\n                            delete state.program;\r\n                            delete this._epg[nid][sid][eid];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            setTimeout(this._gc.bind(this), this._epgGCInterval);\r\n\r\n            log.info(\"EPG GC has finished and removed %d events\", count);\r\n\r\n            return Promise.resolve();\r\n        });\r\n    }\r\n}\r\n\r\nfunction isBasicTable(tableId: number): boolean {\r\n\r\n    if (tableId < 0x60) {\r\n        if (tableId < 0x58) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    } else {\r\n        if (tableId < 0x68) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\nfunction isOutOfDate(state: EventState, eit): boolean {\r\n\r\n    if (isBasicTable(eit.table_id) === true) {\r\n        if (state.version.basic === eit.version_number) {\r\n            return false;\r\n        }\r\n    } else {\r\n        if (state.version.extended === eit.version_number) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction getProgramId(networkId: number, serviceId: number, eventId: number): number {\r\n    return parseInt(networkId + (serviceId / 100000).toFixed(5).slice(2) + (eventId / 100000).toFixed(5).slice(2), 10);\r\n}\r\n\r\nfunction getTime(buffer: Buffer): number {\r\n\r\n    const mjd = (buffer[0] << 8) | buffer[1];\r\n\r\n    let y = (((mjd - 15078.2) / 365.25) | 0);\r\n    let m = (((mjd - 14956.1 - ((y * 365.25) | 0)) / 30.6001) | 0);\r\n    let d = mjd - 14956 - ((y * 365.25) | 0) - ((m * 30.6001) | 0);\r\n\r\n    const k = (m === 14 || m === 15) ? 1 : 0;\r\n\r\n    y = y + k + 1900;\r\n    m = m - 1 - k * 12;\r\n\r\n    let h = (buffer[2] >> 4) * 10 + (buffer[2] & 0x0F);\r\n    let i = (buffer[3] >> 4) * 10 + (buffer[3] & 0x0F);\r\n    let s = (buffer[4] >> 4) * 10 + (buffer[4] & 0x0F);\r\n\r\n    return new Date(y, m - 1, d, h, i, s).getTime();\r\n}\r\n\r\nfunction getTimeFromBCD24(buffer: Buffer): number {\r\n\r\n    let time = ((buffer[0] >> 4) * 10 + (buffer[0] & 0x0F)) * 3600;\r\n    time += ((buffer[1] >> 4) * 10 + (buffer[1] & 0x0F)) * 60;\r\n    time += (buffer[2] >> 4) * 10 + (buffer[2] & 0x0F);\r\n\r\n    return time * 1000;\r\n}\r\n\r\nfunction getGenre(content: any): db.ProgramGenre {\r\n    return {\r\n        lv1: content.content_nibble_level_1,\r\n        lv2: content.content_nibble_level_2,\r\n        un1: content.user_nibble_1,\r\n        un2: content.user_nibble_2\r\n    };\r\n}\r\n\r\nfunction getRelatedProgramItem(event: any): db.ProgramRelatedItem {\r\n    return {\r\n        networkId: event.original_network_id,\r\n        serviceId: event.service_id,\r\n        eventId: event.event_id\r\n    };\r\n}\r\n\r\nexport default new EPG();"],"sourceRoot":"/source/"}